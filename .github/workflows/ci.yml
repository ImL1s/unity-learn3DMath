name: Unity Meta Check

on:
  push:
    branches: [ master ]
  pull_request:
    branches: [ master ]

jobs:
  validate-meta-files:
    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v3

    - name: Check for missing .meta files
      run: |
        # Find all files in Assets that are NOT .meta files and check if they have a .meta
        find Assets -path '*/.*' -prune -o -type f -print | grep -v "\.meta$" | while read -r file; do
          if [ ! -f "$file.meta" ]; then
            echo "❌ Missing meta file for: $file"
            exit 1
          fi
        done
        echo "✅ All files have corresponding .meta files."

    - name: Check for dangling .meta files
      run: |
        # Find all .meta files and check if the source file exists
        find Assets -name "*.meta" -type f | while read -r meta; do
          source="${meta%.meta}"
          if [ ! -e "$source" ]; then
            echo "❌ Dangling meta file found: $meta"
            exit 1
          fi
        done
        echo "✅ No dangling .meta files found."
